# フォルダ構造トレーナー 設計書

## 概要

Windowsのフォルダ構造（フォルダ・ファイル・入れ子）を学ぶためのWebアプリ。
職業訓練の受講生（高校生レベル）が対象。

## 技術スタック

- TypeScript + p5.js
- HTML/CSS（レイアウト・テキスト表示・ツリー表示）
- Vite（ビルド）
- GitHub Pages または ローカルで展開

## ゲームフロー

### 整理型

1. 問題選択画面で問題を選ぶ
2. フラットに並んだフォルダ・ファイルが右側に表示される
3. テキスト指示を読みながら、ドラッグ＆ドロップで正しい入れ子構造に整理する
4. 正解チェック後、結果画面で確認

### モード

- **練習モード（practice）**: ドロップ時に即時判定。不正解なら元の位置に戻す。正解の場所にしか置けない
- **演習モード（exercise）**: 完了ボタンで一括判定。正解は緑、不正解は赤で表示。スコア表示あり

### 操作

- ファイル/フォルダをドラッグしてフォルダにドロップ（移動）
- フォルダをダブルクリックで中に入る
- 「上へ」ボタンで親フォルダに戻る
- 新規作成・削除は行わない（将来対応予定）

## 画面構成

```text
┌──────────────────────────────────┐
│ 指示テキスト（常時表示）            │
├──────────┬───────────────────────┤
│ ツリー表示 │ アイコン表示            │
│（読み取り  │（p5.js キャンバス）      │
│  専用）    │ ドラッグ＆ドロップ操作    │
│           │                       │
├──────────┴───────────────────────┤
│ 答え合わせボタン / 結果表示          │
└──────────────────────────────────┘
```

### 画面遷移

```text
問題選択画面 → 問題画面 → 結果画面
    ↑                        │
    └────────────────────────┘
```

- **問題選択画面**: 問題一覧をリスト表示。練習/演習のラベル付き
- **問題画面**: エクスプローラー風UI。指示を見ながら操作
- **結果画面**: 正解/不正解の一覧。「もう一度」「問題選択に戻る」ボタン

## UI分担

### HTML/CSS担当

- 全体レイアウト（上部指示エリア、左右パネル、下部ボタン）
- 指示テキスト表示
- 左側ツリー表示（ul/liのネストで表現）
- 答え合わせボタン、問題選択画面
- 結果表示（正解/不正解の色付け）

### p5.js担当

- 右側アイコン表示エリアのキャンバス
- フォルダ・ファイルアイコンの描画
- ドラッグ＆ドロップの操作処理
- ドロップ可/不可のビジュアルフィードバック

### 連携

- p5.js側で移動操作が発生 → 内部のデータモデルを更新 → DOM側のツリー表示を再描画
- データモデルが唯一の真実（Single Source of Truth）

## データ構造

### 問題データ（JSON）

```json
{
  "id": "q001",
  "title": "仕事のファイルを整理しよう",
  "mode": "practice",
  "instructions": [
    "「報告書.docx」を「仕事」フォルダに入れてください",
    "「議事録.txt」を「仕事」フォルダの中の「会議」フォルダに入れてください",
    "「猫.jpg」を「プライベート」フォルダに入れてください"
  ],
  "items": [
    { "id": "f1", "name": "仕事", "type": "folder" },
    { "id": "f2", "name": "会議", "type": "folder" },
    { "id": "f3", "name": "プライベート", "type": "folder" },
    { "id": "d1", "name": "報告書.docx", "type": "file" },
    { "id": "d2", "name": "議事録.txt", "type": "file" },
    { "id": "d3", "name": "猫.jpg", "type": "file" }
  ],
  "answer": {
    "仕事": {
      "会議": {
        "議事録.txt": null
      },
      "報告書.docx": null
    },
    "プライベート": {
      "猫.jpg": null
    }
  }
}
```

### データ設計のポイント

- `items`の`id`: アプリ内部のドラッグ＆ドロップ管理用
- `answer`: 名前ベースのツリー構造で正解判定。フォルダはオブジェクト、ファイルは`null`
- `mode`: `"practice"`（練習・即時判定）/ `"exercise"`（演習・一括判定）
- 同一フォルダ内に同名アイテム不可（実際のWindowsと同じルール）
- 将来の新規作成・リネーム機能にも名前ベース判定で対応可能
- 将来GAS Web API対応時も同じJSON形式を返せばOK

## モジュール構成

```text
src/
  main.ts          … エントリポイント、画面遷移管理
  models/
    FileSystem.ts  … フォルダ・ファイルのデータモデル、移動・判定ロジック
  views/
    SelectView.ts  … 問題選択画面（DOM）
    GameView.ts    … 問題画面の統括
    TreeView.ts    … 左側ツリー表示（DOM）
    IconView.ts    … 右側アイコン表示（p5.js）
    ResultView.ts  … 結果画面（DOM）
  data/
    questions.json … 問題データ
```

## 正解判定

### 判定ロジック

- ユーザーの現在のツリー構造を`answer`のツリーと再帰的に比較
- 各アイテムについて「正しい親フォルダにあるか」をチェック
- ルート直下に残っているべきでないアイテムがあれば不正解

### 練習モード

- ドロップした瞬間に、そのアイテムが正しい位置か判定
- 正解 → アイテムが緑にハイライト
- 不正解 → 元の位置に戻す（正しい場所にしか置けない）

### 演習モード

- 完了ボタンで全体を一括チェック
- ツリー表示とアイコン表示の両方で、正解は緑・不正解は赤に色付け
- スコア表示（例: 「3/6 正解」）

## 将来の拡張

- **お題再現型**: 完成図を見せて同じ構造を作らせる
- **段階レッスン型**: ステップごとにガイド付きで進める
- **新規作成・リネーム・削除操作**: フォルダ/ファイルの作成機能
- **GAS Web API連携**: 問題データの外部管理
- **ツリー側でもドラッグ＆ドロップ可能にする**
